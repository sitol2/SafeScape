{% load static %}
<!doctype html>
<html class="no-js" lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="https://fonts.googleapis.com/css?family=Poppins:100,100i,200,200i,300,300i,400,400i,500,500i,600,600i,700,700i,800,800i,900,900i" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Rufina:400,700" rel="stylesheet">
    <title>Bureau of Fire Protection (Sta. Cruz)</title>
    <link rel="shortcut icon" type="image/icon" href="{% static 'assets/logo/bfp logo.png' %}" />
    <link rel="stylesheet" href="{% static 'assets/css/bootstrap.min.css' %}">
    <link rel="stylesheet" href="{% static 'assets/css/font-awesome.min.css' %}">
    <link rel="stylesheet" href="{% static 'assets/css/style.css' %}">
    <link rel="stylesheet" href="{% static 'assets/css/responsive.css' %}">
</head>

<body>
    <section id="home" class="welcome-hero">
        <div class="top-area">
            <div class="header-area">
                <nav class="navbar navbar-default bootsnav navbar-sticky navbar-scrollspy" data-minus-value-desktop="70" data-minus-value-mobile="55" data-speed="1000">
                    <div class="container">
                        <div class="navbar-header" style="text-align: left;">
                             <a class="navbar-brand" href="/" style="display: flex; align-items: center; gap: 10px;">
                                <img src="{% static 'assets/logo/bfp logo.png' %}" alt="Logo" class="logo">
                                <div style="display: flex; align-items: center; gap: 10px;">
                                    <div class="brand-text">
                                        <span class="small-text">BUREAU OF FIRE PROTECTION</span>
                                        <span class="large-text">SANTA CRUZ</span>
                                    </div>
                                    <img src="{% static 'assets/logo/stacruz.png' %}" alt="Second Logo" class="logo">
                                </div>
                            </a>
                        </div>
                        <div class="philippine-time" style="text-align: right; padding: 5px 0; background-color: #a61818;">
                            <p style="margin: 0; font-size: 12px; font-weight: bold; color: #fff;">Philippine Standard Time:</p>
                            <p id="philTime" style="margin: 0; font-size: 14px; color: #fff;"></p>
                        </div>
                        <div class="collapse navbar-collapse" id="navbar-menu">
                            <ul class="nav navbar-nav navbar-right">
                               {% if user.is_authenticated %}
									<li><a href="#">Welcome, {{ user.username }}</a></li>
									<li>
										<form action="{% url 'logout' %}" method="post" style="display: inline;">
											{% csrf_token %}
											<button type="submit" class="btn btn-link" style="padding: 15px; color: #777; background: none; border: none; text-decoration: none;">
												Logout
											</button>
										</form>
									</li>
								{% else %}
                                    <li><a href="{% url 'login' %}">Login</a></li>
                                    <li><a href="{% url 'register' %}">Register</a></li>
                                {% endif %}
                            </ul>
                        </div>
                    </div>
                </nav>
            </div>
            <div class="clearfix"></div>
        </div>

        <div class="hero-slideshow">
            <img src="{% static 'assets/images/slide 10.jpg' %}" class="slide active" alt="Slide 1">
        </div>

        <div class="welcome-hero-txt">
            <div class="container">
                <div class="service-content">
                    <div class="row">
                        {% for category in categories %}
                        <div class="col-lg-6 col-md-6 col-sm-6 col-xs-6">
                            <div class="single-service-item" onclick="openModal('{{ category.slug }}-modal')">
                                <div class="single-service-icon image-box text-center">
                                    <img src="{% static category.icon_path %}" alt="{{ category.name }} icon" class="service-img">
                                </div>
                                <h4><a href="#">{{ category.name|upper }}</a></h4>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                </div>
            </div>
        </div>
    </section>

    {% for category in categories %}
    <div id="{{ category.slug }}-modal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('{{ category.slug }}-modal')">×</span>
            <p class="phone-number" style="color: #a61818;">{{ category.name|upper }}</p>
            <hr>
            <div class="mini-card-grid">
                {% for resource in category.resource_set.all %}
                <div class="mini-card" onclick="openModal('{{ resource.slug }}-resource-modal')">
                    <img src="{% static resource.icon_path %}" alt="{{ resource.title }}">
                    <p class="card-label">{{ resource.title }}</p>
                </div>
                {% endfor %}
            </div>
        </div>
    </div>
    {% endfor %}

    {% for resource in resources %}
    {% if resource.slug and resource.content_url %}
    <div id="{{ resource.slug }}-resource-modal" class="custom-modal">
        <div class="custom-modal-content">
            <span class="close" onclick="closeModal('{{ resource.slug }}-resource-modal')">×</span>
            <div class="video-container">
                <iframe id="{{ resource.slug }}-player" width="560" height="315" data-src="{{ resource.content_url }}" title="{{ resource.title }} Video" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen></iframe>
            </div>
        </div>
    </div>
    {% endif %}
    {% endfor %}
    <script src="{% static 'assets/js/jquery.js' %}"></script>
    <script src="{% static 'assets/js/custom.js' %}"></script>

    <script>
        // Universal open and close modal functions
        function openModal(modalId) {
            const modal = document.getElementById(modalId);
            if (modal) {
                modal.style.display = "block";
                const iframe = modal.querySelector('iframe');
                // If there's an iframe, set its src from data-src to start loading the video now
                if (iframe && iframe.dataset.src && !iframe.src) {
                    iframe.src = iframe.dataset.src;
                }
            }
        }

        function closeModal(modalId) {
            const modal = document.getElementById(modalId);
            if (modal) {
                modal.style.display = "none";
                const iframe = modal.querySelector('iframe');
                // Stop the video by clearing the src attribute
                if (iframe) {
                    iframe.src = "";
                }
            }
        }

        // Philippine Time Clock
        function updatePhilippineTime() {
            const now = new Date();
            const dateOptions = { timeZone: 'Asia/Manila', year: 'numeric', month: 'long', day: 'numeric' };
            const timeOptions = { timeZone: 'Asia/Manila', hour: '2-digit', minute: '2-digit', second: '2-digit', hour12: true };
            const date = new Intl.DateTimeFormat('en-US', dateOptions).format(now);
            const time = new Intl.DateTimeFormat('en-US', timeOptions).format(now);
            document.getElementById('philTime').textContent = `${date}, ${time}`;
        }
        setInterval(updatePhilippineTime, 1000);
        updatePhilippineTime();
    </script>
</body>
</html>